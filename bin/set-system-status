#!/usr/bin/env bash
#
# Uses `xsetroot` to store the current system status summary in the WM_NAME X11
# property. It is being used by the `dwm` window manager.
#
# See https://dwm.suckless.org/status_monitor/
#
# set-system-status

wifi=$(nmcli -f ACTIVE,SSID,SIGNAL dev wifi list | awk '/yes/{ print $2 " " $3 "%" }')
dev=$(ip r | awk '/^default/{ print $5 }')
ip=$(ip r | awk -v dev="$dev" '$3 ~ dev { print $9 }')
cpu=$(awk '{ print $1 }' /proc/loadavg)
time=$(date +"%a %b %d %I:%M")

if [ -z "$wifi" ]; then
  net=$ip
else
  net="$wifi ($ip)"
fi

if [ -z "$(acpi -b)" ]; then
  bat='âœ•'
else
  bat="$(acpi -b | awk '/Battery 0/{ print $3 " " $4 }' | sed 's/,//g;s/Unknown //g')"
fi

xsetroot -name " $net / $cpu / $bat / $HOSTNAME - $time "
