#!/usr/bin/env bash
#
# Uses `xsetroot` to store the current system status summary in the WM_NAME X11
# property. It is being used by the `dwm` window manager.
#
# See https://dwm.suckless.org/status_monitor/
#
# set-system-status

WIFI=$(nmcli -f ACTIVE,SSID,SIGNAL dev wifi list | awk '/yes/{ print $2 " " $3 "%" }')
DEV=$(ip r | awk '/^default/{ print $5 }')
IP=$(ip r | awk -v dev="$DEV" '$3 ~ dev { print $9 }')
CPU_LOAD=$(awk '{ print $1 }' /proc/loadavg)
TIME=$(date +"%a %b %d %I:%M")

if [ -z "$WIFI" ]; then
  NET='eth'
else
  NET=$WIFI
fi

if acpi -a | grep off-line > /dev/null; then
  BAT='âœ•'
else
  BAT="$(acpi -b | awk '/Battery 0/{ print $3 " " $4 }' | sed 's/,//g;s/Unknown //g')"
fi

xsetroot -name " $NET ($IP) / $CPU_LOAD / $BAT / $HOSTNAME - $TIME "
